Data and code for the manuscript "Deconstructing the gendergap in chess ratings" (in prep).


Software dependencies: R (tested with R 4.2.1 and 4.2.2). Required R packages:
  - `tidyverse`: Efficient data manipulation and plotting
  - `Rcpp`: Importing and compiling functions written in C++
* Required non-standard hardware: none. However, reproducing the permutation results with sufficiently many permutations (more than a hundred thousand per sample) does benefit from having access to a computing cluster.


Contents of the `code` directory:

* `compare-Richard-Gyuri-data.R`: Making sure that the data which were independently collected and analyzed by different team members do line up.
* `download-and-clean.R`: Automatically download and process the FIDE rating data. The final output consists of two files in the `data` directory: `raw-data.rds` (with data for all months between October 2012 and December 2019), and `rating-data.csv` (with data just for December 2019 -- however, with the `games` column containing the total number of games played from Oct 2012 to Dec 2019).
* `experience-gap.R`: An exploratory graph on how the difference between the experience of women and men chess players depends on their rating.
* `generate-perm-table-cluster.R`: A script that will create rating permutations of the ratings of women and men, for each federation, and for a given parameterization. Here "parameterization" means 1) whether junior players (those born before 1999) are excluded, 2) whether inactive players are excluded, 3) whether only players rated below a certain rating floor are excluded (the options are 1000, 1400, or 1600), and 4) which metric is to be calculated (mean, median, sd, top1, or top10). The purpose of this script is to act as one that can be submitted to a large computing cluster. It takes two command-line input parameters:
  - `rownum`: an integer between 1 and 60 (inclusive), determining which combination of the above parameters will be implemented.
  - `perms`: a positive integer, setting the number of random permutations of a given federation's ratings to be generated. For example, if `perms` is `100`, then the ratings for women and men of any given federation will be randomly reshuffled 100 times, and the assigned metric (mean, median, sd, top1, or top10) calculated over those permutations. (*Note:* in practice, at least one million permutations are required for all parameterizations to reach reasonable convergence.)
* `generate-perm-table.R`: As `generate-perm-table-cluster.R`, but performing the permutations for all parameterizations all at once. This means that it can conveniently be used locally, without having access to a computing cluster. (*Warning:* running this script on standard hardware is only feasible with no more than 100,000 permutations. Even that could take over a day to finish.)
* `launch.R`: A script that automatically creates jobs on a computing cluster and submits them, using the `slurm` scheduler. Parameters such as the account name and loaded modules might need to be changed to account for the particular computing cluster setup available to the user.
* `merge-nulls-Richard.R`: Merging the permutation ("null") runs obtained by Richard Smith (one of our team members) into a single, tidy CSV file.
* `per-federation-analysis.R`: For each chess federation, use the permutation results to see whether one can reject the null hypothesis that observed rating differences between women and men are simply due to a difference in participation.
* `permutation-table.cpp`: Two simple C++ functions, implemented this way to glean more speed. The first function, `top10`, simply takes the average of the ten largest entries from a numerical vector. The second function, `permut_tab`, generates the permutations which are at the heart of the scripts `generate-perm-table.R` and `generate-perm-table-cluster.R`.
* `plot-distr.R`: A simple script to visualize the permutation results, along with the observed difference between women and men.
* `stats-from-nulls.R`: This script processes the output generated by `generate-perm-table-cluster.R` (which tends to be massive, in case the number of permutations is large), and saves them in a single CSV file.
* `weighted-regression.R`: Predicting the (participation-corrected) rating difference between women and men per federation, using age and experience as the predictors (without interaction effects). Experience is defined here as the number of games played by a player between Oct 2012 and Dec 2019 (which is the extent of the data available from FIDE). The regression is weighted, with the weights being the inverse variances of the permutation results per federation.
